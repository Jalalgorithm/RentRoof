@page "/userlogin"
@inject IAccountService accountService
@inject ILocalStorageService localStorage
@inject AuthenticationStateProvider authStateProvider
@inject NavigationManager navigationManager


<h3>Login</h3>
<EditForm Model="userLogin" OnValidSubmit="HandleLogin">

    <label for="username">Name</label>
    <InputText id="username" @bind-Value="userLogin.Email" />
    <label for="password">Password</label>
    <InputText id="password" @bind-Value="userLogin.Password"  type="password" />
    <button type="submit" class="btn btn-primary">Do it!</button>
</EditForm>


@code {
    UserLoginDTO userLogin = new();

    protected override Task OnInitializedAsync()
    {
        return base.OnInitializedAsync();
    }

    public async Task HandleLogin()
    {
        var result = await accountService.Login(userLogin);
        var token = result.Message;

        await localStorage.SetItemAsync("token", token);
        await authStateProvider.GetAuthenticationStateAsync();

        navigationManager.NavigateTo("/");


    }


}
